!function t(n,e,o){function r(a,s){if(!e[a]){if(!n[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=e[a]={exports:{}};n[a][0].call(f.exports,function(t){var e=n[a][1][t];return r(e?e:t)},f,f.exports,t,n,e,o)}return e[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(t,n){function e(){}var o=n.exports={};o.nextTick=function(){var t="undefined"!=typeof window&&window.setImmediate,n="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(t)return function(t){return window.setImmediate(t)};if(n){var e=[];return window.addEventListener("message",function(t){var n=t.source;if((n===window||null===n)&&"process-tick"===t.data&&(t.stopPropagation(),e.length>0)){var o=e.shift();o()}},!0),function(t){e.push(t),window.postMessage("process-tick","*")}}return function(t){setTimeout(t,0)}}(),o.title="browser",o.browser=!0,o.env={},o.argv=[],o.on=e,o.addListener=e,o.once=e,o.off=e,o.removeListener=e,o.removeAllListeners=e,o.emit=e,o.binding=function(){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(){throw new Error("process.chdir is not supported")}},{}],2:[function(t,n){function e(t){function n(t){return null===u?void f.push(t):void i(function(){var n=u?t.onFulfilled:t.onRejected;if(null===n)return void(u?t.resolve:t.reject)(c);var e;try{e=n(c)}catch(o){return void t.reject(o)}t.resolve(e)})}function e(t){try{if(t===l)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var n=t.then;if("function"==typeof n)return void r(n.bind(t),e,a)}u=!0,c=t,s()}catch(o){a(o)}}function a(t){u=!1,c=t,s()}function s(){for(var t=0,e=f.length;e>t;t++)n(f[t]);f=null}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");var u=null,c=null,f=[],l=this;this.then=function(t,e){return new l.constructor(function(r,i){n(new o(t,e,r,i))})},r(t,e,a)}function o(t,n,e,o){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof n?n:null,this.resolve=e,this.reject=o}function r(t,n,e){var o=!1;try{t(function(t){o||(o=!0,n(t))},function(t){o||(o=!0,e(t))})}catch(r){if(o)return;o=!0,e(r)}}var i=t("asap");n.exports=e},{asap:4}],3:[function(t,n){function e(t){this.then=function(n){return"function"!=typeof n?this:new o(function(e,o){r(function(){try{e(n(t))}catch(r){o(r)}})})}}var o=t("./core.js"),r=t("asap");n.exports=o,e.prototype=o.prototype;var i=new e(!0),a=new e(!1),s=new e(null),u=new e(void 0),c=new e(0),f=new e("");o.resolve=function(t){if(t instanceof o)return t;if(null===t)return s;if(void 0===t)return u;if(t===!0)return i;if(t===!1)return a;if(0===t)return c;if(""===t)return f;if("object"==typeof t||"function"==typeof t)try{var n=t.then;if("function"==typeof n)return new o(n.bind(t))}catch(r){return new o(function(t,n){n(r)})}return new e(t)},o.all=function(t){var n=Array.prototype.slice.call(t);return new o(function(t,e){function o(i,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(t){o(i,t)},e)}n[i]=a,0===--r&&t(n)}catch(u){e(u)}}if(0===n.length)return t([]);for(var r=n.length,i=0;i<n.length;i++)o(i,n[i])})},o.reject=function(t){return new o(function(n,e){e(t)})},o.race=function(t){return new o(function(n,e){t.forEach(function(t){o.resolve(t).then(n,e)})})},o.prototype["catch"]=function(t){return this.then(null,t)}},{"./core.js":2,asap:4}],4:[function(t,n){(function(t){function e(){for(;r.next;){r=r.next;var t=r.task;r.task=void 0;var n=r.domain;n&&(r.domain=void 0,n.enter());try{t()}catch(o){if(u)throw n&&n.exit(),setTimeout(e,0),n&&n.enter(),o;setTimeout(function(){throw o},0)}n&&n.exit()}a=!1}function o(n){i=i.next={task:n,domain:u&&t.domain,next:null},a||(a=!0,s())}var r={task:void 0,next:null},i=r,a=!1,s=void 0,u=!1;if("undefined"!=typeof t&&t.nextTick)u=!0,s=function(){t.nextTick(e)};else if("function"==typeof setImmediate)s="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var c=new MessageChannel;c.port1.onmessage=e,s=function(){c.port2.postMessage(0)}}else s=function(){setTimeout(e,0)};n.exports=o}).call(this,t("_process"))},{_process:1}],5:[function(){"function"!=typeof Promise.prototype.done&&(Promise.prototype.done=function(){var t=arguments.length?this.then.apply(this,arguments):this;t.then(null,function(t){setTimeout(function(){throw t},0)})})},{}],6:[function(t){t("asap"),"undefined"==typeof Promise&&(Promise=t("./lib/core.js"),t("./lib/es6-extensions.js")),t("./polyfill-done.js")},{"./lib/core.js":2,"./lib/es6-extensions.js":3,"./polyfill-done.js":5,asap:4}]},{},[6]),define("Promise",function(t){return function(){var n;return n||t.Promise}}(this)),define("js/game.js",["Promise"],function(t){return function(n,e,o,r,i,a,s,u){var c={player1:void 0,player2:void 0,history:[],history2:[],promise:void 0,time:0,terminate:void 0,state:"initiating"};c.terminate=function(t){switch(console.debug("state: "+this.state),this.state){case"initiating":break;case"running":this.player1.stop(),this.player2.stop();break;case"stopped":return void console.debug("state: "+this.state)}this.state="stopped",s.call(this,t)};var f=function(n,e,o){return 0>=e?n:new t(function(t,o){n.then(t),window.setTimeout(function(){o("time out")},e)}).catch(function(){return 3}).then(function(t){return"stopped"!=c.state?(o(),t):void 0})},l=function(n,e,s){return 0===u--?void c.terminate("no more turns"):(r.call(c),t.all([f.call(this,c.player1.getHand(n,e,s),o,i),f.call(this,c.player2.getHand(e,n,s),o,a)]).then(function(t){if("stopped"!=c.state){if(3===t[0]||3===t[1])return void c.terminate("no one finish");var n=c.time;c.time=Date.now(),n=c.time-n,n=0|Math.log(n/64,1.5),n>15&&(n=15),0>n&&(n=0),c.history.push((3&t[0])+4*(3&t[1])+16*n),c.promise=l(t[0],t[1],n)}}).catch(function(t){c.terminate(t)}))};return c.promise=t.all([n,e]).then(function(t){return"stopped"!==c.state?(c.player1=t[0],c.player2=t[1],c.time=Date.now(),c.state="running",l(3,3,0)):void 0}).catch(function(t){c.terminate(t)}),c}}),define("js/player/human.js",["Promise"],function(t){return function(n){console.debug("passed");var e=function(){},o={test:"debug",a:e},r=Array(3);return n.doms.forEach(function(t,n){r[n]=function(){o.a(n),o.a=e},$(t).on("click",r[n])}),t.resolve({getHand:function(){return new t(function(t){o.a=t})},stop:function(){n.doms.forEach(function(t,n){$(t).off("click",r[n])})}})}}),define("js/PlayerError.js",[],function(){var t=function(t,n){this.message="PLAYER: "+t,this.data=n};return t.prototype=new Error,t}),define("js/text_to_url.js",[],function(){var t=window.URL||window.webkitURL,n=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;return function(e,o){o||(o="");var r;try{r=new Blob([e],{type:o})}catch(i){r=new n,r.append(e),r=r.getBlob()}return t.createObjectURL(r)}}),define("js/tokens.js",[],function(){var t=0,n={store:function(n){var e=t++;return this[e]=n,e},forEach:function(t){for(var n in this)this.hasOwnProperty(n)&&t(this[n],Number(n),this)}},e=function(){};return e.prototype=n,e}),define("js/worker.js",["./text_to_url.js","./tokens.js"],function(t,n){var e=function(t,n){n.data.log&&console.log(n.data.log),n.data.hasOwnProperty("rtn")&&(t.tokens[n.data.token].a(n.data.rtn),delete t.tokens[n.data.token]),n.data.error&&(t.tokens[n.data.token].b(n.data.error),delete t.tokens[n.data.token])},o=function(t,n){console.error(n),n.data.token&&(t.tokens[n.data.token].b(n.data.error),delete t.tokens[n.data.token])},r=function(n){var r=new Worker(t(n,"text/javascript")),i=this;return r.onmessage=function(t){return e(i,t)},r.onerror=function(t){return o(i,t)},r},i={init:function(t){this.stop(),this.worker=r.call(this,t)},stop:function(){if(null!==this.worker){this.tokens.forEach(function(t){t.b("worker stopped")}),this.tokens=new n,this.worker.terminate(),this.worker=null}},call:function(){for(var t=arguments,n=this,e=Array(t.length+1),o=0;o<t.length;o++)e[o+1]=t[o];return new Promise(function(t,o){var r=n.tokens.store({a:t,b:o});e[0]=r,n.worker.postMessage(e)})}},a=function(){this.worker=null,this.tokens=new n,this.promise=Promise.resolve()};return a.prototype=i,a}),define("js/player/bot.js",["../PlayerError.js","../worker.js","../tokens.js","Promise"],function(t,n,e,o){var r=function(n,e){t.call(this,n,e)};r.prototype=new t;var i=function(t){var e=new n,i=function(){var t=arguments;return e.call.apply(e,t).catch(function(n){throw new r("At calling worker."+t[0]+":"+n.message,n)})};return o.resolve($.ajax({url:t.boturi})).catch(function(t){var n=new r("Cannot load bot source from uri. message: "+t.statusText+".",t);throw n}).then(function(n){try{-1!==t.boturi.indexOf("api.github.com/repos")&&(n=atob(n.content.replace(/\n/g,"")))}catch(o){throw new r("Cannot read bot source from github",o)}try{e.init(n)}catch(o){throw new r("Cannot parse bot source, message: "+o.message,o)}}).then(function(){var n=t.dataurl;try{if(""===n)return void 0;var e=n[n.length-1];if("?"===e||"&"===e){var i=JSON.stringify(t);n+="hash="+i}}catch(a){throw new r("Cannot general data uri. message: error",a)}return o.resolve($.ajax({url:n,dataType:"json"})).catch(function(){return console.warn("Error loading bot data"),void console.warn("Using undefined as data")})}).then(function(n){return i("init",t.botparam,n).catch(function(t){throw new r("Cannot init bot.",t)})}).then(function(){return{getHand:function(t,n,e){return i("update",t,n,e).then(function(){return i("getHand")})},stop:function(){e.stop()}}})};return i}),define("js/consts.js",[],function(){var t={randomInt:function(t){return Math.random()*t|0},abbr:["r","p","s","x"],result:["TIE","LOSE","WIN","UNKNOWN"],bottext:[["Interesting play.","Tie is not good enough!"],["I knew I would beat you!","Your mind is too easy to guess.","Don't be so easy on me."],["I can do better next time!","I lost, that's impossible!","How did I loose?"],["I'm broken... %&#$@^"],["I'm ready to play!"]]},n=0;return t.bottext.forEach(function(t){t.forEach(function(t){n=n>t.length?n:t.length})}),t.bottext.forEach(function(t){t.forEach(function(t,e,o){o[e]=t+Array(n-t.length+1).join(" ")})}),t}),define("js/main.js",["./game.js","./player/human.js","./player/bot.js","./consts.js"],function(t,n,e,o){var r=function(){return{boturi:$("#wa_source").val(),dataurl:$("#wa_data").val(),botparam:$("#wa_param").val()}},i=function(t){var n=t[0]+t[1]+t[2],e=function(e){return 0===n?100/3+"%":(100*t[e]/n+.5|0)+"%"};$("#s_bar > div").each(function(t){t=(t+2)%3,$(this).css("width",e(t))}),$("#s_text > span").each(function(e){return 0===e?void(this.innerHTML=n):(e=(e-1+2)%3,void(this.innerHTML=t[e]))})},a=function(t,n){$("#gr_0 > img").attr("src","asset/rps_"+o.abbr[t]+"0.jpg").toggleClass("gr_0i0").toggleClass("gr_0i1"),$("#gr_1 > img").attr("src","asset/rps_"+o.abbr[n]+"1.jpg").toggleClass("gr_1i0").toggleClass("gr_1i1")},s=function(t){var n=o.bottext[t];$("#g_bottext").text(n[o.randomInt(n.length)])};global=s;var u,c,f=function(){var t=u.history[u.history.length-1];if(void 0===t)return void(t=15);var n=3&t,e=t/4&3;a(n,e),$("#rh_tbody").prepend($("#w_roundR").html().replace("td>1</td","td>"+u.history.length+"</td").replace(/x(?=(0\.jpg))/,o.abbr[n]).replace(/x(?=(1\.jpg))/,o.abbr[e]).replace(/TIE/,o.result[(e-n+3)%3]));var r=[0,0,0];u.history.forEach(function(t){var n=3&t,e=t/4&3,o=(e-n+3)%3;3===n&&(o=1),3===e&&(o=2),r[o]++}),i(r);var c=(e-n+3)%3;s(c)},l=function(){},d=function(t){console.log("end!!!"),t instanceof Error?s(3):$("#g_bottext").text("Game ended. Happy to play with you again!")},p=function(){$("#rh_tbody").html(""),void 0!==u&&(a(3,3),s(4)),i([0,0,0]),c=r();var o=$("#g_hand > div").toArray(),p=n({doms:o}),h=e(c);u=t(p,h,0,f,l,l,d,50)},h=function(){void 0!==u&&u.terminate(),p()};$("#wh_submit").on("click",function(){var t=$("#wh_name").val();$("#g_name").text(t)}),$("#c_restart").on("click",function(){return h(),!1}),$.getJSON("js/botList.json",function(t){var n=$("#wb_list").html(),e=$("#wb_list").empty(),o=function(){e.children().removeClass("active");var t=$(this).addClass("active").data("param");console.log(t),$("#wa_source").val(t.param.boturi),$("#wa_data").val(t.param.dataurl),$("#wa_param").val(t.param.botparam),$("#g_botname").text(t.name),h()};t.bots.forEach(function(t){console.log(t);var r=$(n.replace("${name}",t.name).replace("${description}",t.description)).data("param",t).on("click",o);e.append(r)}),e.children()[0].click(),$("#wa_submit").on("click",h)})});